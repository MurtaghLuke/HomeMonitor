<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Home Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

</head>
<body>
  <h1>Home Monitor</h1>
  <!-- check server is running -->
  <div class="card" id="health">Checking server…</div> 
  <div class="card" id="latest">Loading latest reading…</div>



  <!-- Below functions made with AI -->
  <script>
    const API = ""; 
    
    //fetches url, throws error if not ok. returns json
    async function getJSON(url){
      const r = await fetch(url);
      if(!r.ok) throw new Error(await r.text());
      return r.json();
    }
    

    //updates the latest card.
    function renderLatest(d){       //if no data then print "no data"
        const el = document.getElementById("latest");
        if(!d || d.detail)
        { 
            el.textContent = "No data"; 
            return; 
        }
        const localTime = new Date(d.ts).toLocaleString("en-GB", {timeZone: "Europe/Dublin" });  //convert to irish time
        el.innerHTML = `<b>${d.sensor}</b> = ${d.value} @ <small>${localTime}</small>`;
    }
    

    
    // calls the backend and passes the responses to the render functions.
    async function refresh(){
        try{
            const h = await getJSON("/health");
            document.getElementById("health").textContent = `Server: ${h.status}`;
        }
        catch{ 
            document.getElementById("health").textContent = "Server offline";
        }
    
        try{ 
            renderLatest(await getJSON("/api/readings/latest")); 
        }
        catch
        { 
            renderLatest(null); 
        }
    }
    
    // refresh runs ons on load and then every 3 seconds.
    refresh();
    setInterval(refresh, 3000);
</script>
</body>
</html>